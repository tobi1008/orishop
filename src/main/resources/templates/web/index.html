<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{decorators/main}">

<head>
    <title>Trang chủ - OriShop</title>
</head>

<body>
    <div layout:fragment="content" class="bg-light pb-5">

        <!-- Main Section: Banner (Full Width) -->
        <div class="container-fluid p-0 mb-5">
            <div id="mainBannerCarousel" class="carousel slide shadow-sm overflow-hidden" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#mainBannerCarousel" data-bs-slide-to="0" class="active"
                        aria-current="true"></button>
                    <button type="button" data-bs-target="#mainBannerCarousel" data-bs-slide-to="1"></button>
                    <button type="button" data-bs-target="#mainBannerCarousel" data-bs-slide-to="2"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="d-flex align-items-center justify-content-center text-white text-center position-relative"
                            style="height: 600px; background: linear-gradient(45deg, #0f0c29, #302b63, #24243e);">
                            <div class="z-1 container">
                                <h1 class="display-3 fw-bold mb-3 font-heading text-light" style="letter-spacing: 2px;">
                                    BỘ
                                    SƯU TẬP MỚI</h1>
                                <p class="fs-4 mb-4 opacity-75 fw-light">Đẳng cấp thời thượng - Nâng tầm phong cách</p>
                                <a href="/product"
                                    class="btn btn-light px-5 py-3 fw-bold rounded-0 text-uppercase shadow-lg hover-lift">Khám
                                    Phá Ngay</a>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="d-flex align-items-center justify-content-center text-white text-center"
                            style="height: 600px; background: linear-gradient(45deg, #134E5E, #71B280);">
                            <div class="z-1 container">
                                <h1 class="display-3 fw-bold mb-3 font-heading">CHĂM SÓC DA TOÀN DIỆN</h1>
                                <p class="fs-4 mb-4 opacity-75 fw-light">Tinh hoa thiên nhiên - Vẻ đẹp thuần khiết</p>
                                <a href="/category/skincare"
                                    class="btn btn-outline-light px-5 py-3 fw-bold rounded-0 text-uppercase shadow-lg hover-lift">Xem
                                    Chi Tiết</a>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="d-flex align-items-center justify-content-center text-white text-center"
                            style="height: 600px; background: linear-gradient(45deg, #C04848, #480048);">
                            <div class="z-1 container">
                                <h1 class="display-3 fw-bold mb-3 font-heading">ƯU ĐÃI ĐẶC BIỆT</h1>
                                <p class="fs-4 mb-4 opacity-75 fw-light">Giảm giá lên đến 50% - Duy nhất hôm nay</p>
                                <a href="/product"
                                    class="btn btn-light px-5 py-3 fw-bold rounded-0 text-uppercase shadow-lg hover-lift">Săn
                                    Sale</a>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#mainBannerCarousel"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#mainBannerCarousel"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>

        <!-- Service Icons (Clean Strip) -->
        <div class="container mb-5">
            <div class="row g-4 text-center">
                <div class="col-md-4">
                    <div class="p-4 border border-light rounded-0 shadow-sm bg-white h-100 hover-card">
                        <i class="fa-solid fa-truck-fast fa-2x mb-3 text-dark"></i>
                        <h6 class="fw-bold text-uppercase font-heading">Giao hàng miễn phí</h6>
                        <p class="text-muted small mb-0">Cho đơn hàng từ 500k</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-4 border border-light rounded-0 shadow-sm bg-white h-100 hover-card">
                        <i class="fa-solid fa-rotate-left fa-2x mb-3 text-dark"></i>
                        <h6 class="fw-bold text-uppercase font-heading">Đổi trả 7 ngày</h6>
                        <p class="text-muted small mb-0">Thủ tục đơn giản, nhanh chóng</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-4 border border-light rounded-0 shadow-sm bg-white h-100 hover-card">
                        <i class="fa-solid fa-shield-halved fa-2x mb-3 text-dark"></i>
                        <h6 class="fw-bold text-uppercase font-heading">Hàng chính hãng</h6>
                        <p class="text-muted small mb-0">Cam kết hoàn tiền 200% nếu giả</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Horizontal Categories Scroll -->
        <div class="container mb-5">
            <div class="text-center mb-4">
                <h3 class="text-uppercase fw-bold font-heading text-dark" style="letter-spacing: 1px;">Danh Mục Sản Phẩm
                </h3>
                <div class="mx-auto bg-dark" style="width: 60px; height: 3px;"></div>
            </div>

            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a th:each="cat : ${globalCategories}"
                    th:href="@{/category/{slug}(slug=${cat.slug != null && cat.slug != '' ? cat.slug : cat.id})}"
                    class="btn btn-outline-dark rounded-0 px-4 py-2 text-uppercase fw-bold"
                    style="min-width: 150px; transition: all 0.3s;"
                    onmouseover="this.classList.remove('btn-outline-dark'); this.classList.add('btn-dark');"
                    onmouseout="this.classList.add('btn-outline-dark'); this.classList.remove('btn-dark');">
                    <span th:text="${cat.name}">Category</span>
                </a>
            </div>
        </div>

        <!-- Flash Sale Section -->
        <div class="container mb-5" th:if="${activeFlashSales != null && !activeFlashSales.isEmpty()}">
            <div class="alert alert-light border border-secondary shadow-sm d-flex align-items-center justify-content-between flex-wrap rounded-0"
                style="background-color: #fff8e1;">
                <div class="d-flex align-items-center">
                    <span class="bg-dark text-white p-2 rounded me-3"><i class="fa fa-bolt"></i></span>
                    <div>
                        <h4 class="mb-0 font-heading text-uppercase text-dark">Flash Sale</h4>
                        <p class="mb-0 text-muted small" th:text="${activeFlashSales[0].name}">Golden Hour</p>
                    </div>
                </div>
                <div class="d-flex align-items-center mt-2 mt-md-0">
                    <span class="me-2 text-uppercase small fw-bold">Kết thúc sau:</span>
                    <div class="h4 mb-0 font-heading text-danger" id="flash-sale-timer">00:00:00</div>
                    <script th:inline="javascript">
                        (function () {
                            const endTime = [[${ activeFlashSales[0].endTime.time }]];

                            function updateTimer() {
                                const now = new Date().getTime();
                                const distance = endTime - now;

                                if (distance < 0) {
                                    document.getElementById("flash-sale-timer").innerHTML = "Đã kết thúc";
                                    return;
                                }

                                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                                document.getElementById("flash-sale-timer").innerHTML =
                                    (hours < 10 ? "0" + hours : hours) + ":" +
                                    (minutes < 10 ? "0" + minutes : minutes) + ":" +
                                    (seconds < 10 ? "0" + seconds : seconds);
                            }

                            setInterval(updateTimer, 1000);
                            updateTimer();
                        })();
                    </script>
                </div>
            </div>
        </div>

        <!-- Best Selling Section -->
        <div class="container mb-5" th:if="${bestSellers != null && !bestSellers.isEmpty()}">
            <div class="d-flex align-items-center justify-content-between mb-4 border-bottom pb-2">
                <h3 class="text-uppercase fw-bold font-heading text-dark mb-0">Sản phẩm bán chạy</h3>
            </div>

            <div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-4">
                <!-- Loop products -->
                <div class="col" th:each="product : ${bestSellers}">
                    <div class="card h-100 card-product">
                        <!-- Badges -->
                        <span th:if="${product.flashSalePrice != null}"
                            class="position-absolute top-0 start-0 badge bg-danger m-2 rounded-0">-<span
                                th:text="${#numbers.formatInteger((1 - product.flashSalePrice/product.price) * 100, 0)}"></span>%</span>

                        <span
                            class="position-absolute top-0 end-0 badge bg-warning text-dark m-2 rounded-0 shadow-sm"><i
                                class="fa-solid fa-crown"></i> Hot</span>

                        <a th:href="@{/product/{slug}(slug=${product.slug != null && product.slug != '' ? product.slug : product.id})}"
                            class="text-decoration-none">
                            <img th:src="${product.images != null && !product.images.isEmpty() ? product.images[0].imageUrl : 'https://via.placeholder.com/300'}"
                                class="card-img-top" alt="Product Image" style="height: 220px; object-fit: cover;">
                        </a>

                        <div class="card-body p-3 text-center">
                            <a th:href="@{/product/{slug}(slug=${product.slug != null && product.slug != '' ? product.slug : product.id})}"
                                class="text-decoration-none text-dark">
                                <h6 class="card-title text-truncate mb-1" th:text="${product.name}">Tên sản phẩm</h6>
                            </a>

                            <div class="mb-2 small">
                                <span class="text-warning" th:if="${product.reviewCount > 0}">
                                    <i class="fa fa-star"></i> <span th:text="${product.averageRating}"></span>
                                    <span class="text-muted"> (<span th:text="${product.reviewCount}"></span>)</span>
                                </span>
                                <span class="text-muted" th:unless="${product.reviewCount > 0}">
                                    <i class="fa fa-star-o text-warning"></i> Chưa có đánh giá
                                </span>
                            </div>

                            <div>
                                <div th:if="${product.flashSalePrice != null}">
                                    <p class="text-danger fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                        th:text="${#numbers.formatDecimal(product.flashSalePrice, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        400.000 đ
                                    </p>
                                    <small class="text-muted text-decoration-line-through small"
                                        th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        500.000 đ
                                    </small>
                                </div>

                                <div th:unless="${product.flashSalePrice != null}">
                                    <div
                                        th:if="${product.discountPrice != null && product.discountPrice > 0 && product.discountPrice < product.price}">
                                        <p class="text-danger fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                            th:text="${#numbers.formatDecimal(product.discountPrice, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                            Sale</p>
                                        <small class="text-muted text-decoration-line-through small"
                                            th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">Original</small>
                                    </div>
                                    <p th:unless="${product.discountPrice != null && product.discountPrice > 0 && product.discountPrice < product.price}"
                                        class="text-dark fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                        th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        500.000 đ</p>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer bg-transparent border-top-0 p-3 pt-0">
                            <a th:href="@{/cart/add/{id}(id=${product.id})}"
                                class="btn btn-outline-primary w-100 btn-sm rounded-1 text-uppercase">Thêm vào giỏ</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product List Section -->
        <div class="container">
            <div class="d-flex align-items-center justify-content-between mb-4 border-bottom pb-2">
                <h3 class="text-uppercase fw-bold font-heading text-dark mb-0">Mới cập nhật</h3>
                <a href="/product" class="btn btn-link text-secondary text-decoration-none">Xem tất cả <i
                        class="fa-solid fa-arrow-right"></i></a>
            </div>

            <div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-4">
                <!-- Loop products -->
                <div class="col" th:each="product : ${products}">
                    <div class="card h-100 card-product">
                        <!-- Badges -->
                        <span th:if="${product.flashSalePrice != null}"
                            class="position-absolute top-0 start-0 badge bg-danger m-2 rounded-0">-<span
                                th:text="${#numbers.formatInteger((1 - product.flashSalePrice/product.price) * 100, 0)}"></span>%</span>

                        <a th:href="@{/product/{slug}(slug=${product.slug != null && product.slug != '' ? product.slug : product.id})}"
                            class="text-decoration-none">
                            <img th:src="${product.images != null && !product.images.isEmpty() ? product.images[0].imageUrl : 'https://via.placeholder.com/300'}"
                                class="card-img-top" alt="Product Image" style="height: 220px; object-fit: cover;">
                        </a>

                        <div class="card-body p-3 text-center">
                            <a th:href="@{/product/{slug}(slug=${product.slug != null && product.slug != '' ? product.slug : product.id})}"
                                class="text-decoration-none text-dark">
                                <h6 class="card-title text-truncate mb-1" th:text="${product.name}">Tên sản phẩm</h6>
                            </a>

                            <div class="mb-2 small">
                                <span class="text-warning" th:if="${product.reviewCount > 0}">
                                    <i class="fa fa-star"></i> <span th:text="${product.averageRating}"></span>
                                    <span class="text-muted"> (<span th:text="${product.reviewCount}"></span>)</span>
                                </span>
                                <span class="text-muted" th:unless="${product.reviewCount > 0}">
                                    <i class="fa fa-star-o text-warning"></i> Chưa có đánh giá
                                </span>
                            </div>

                            <div>
                                <div th:if="${product.flashSalePrice != null}">
                                    <p class="text-danger fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                        th:text="${#numbers.formatDecimal(product.flashSalePrice, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        400.000 đ
                                    </p>
                                    <small class="text-muted text-decoration-line-through small"
                                        th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        500.000 đ
                                    </small>
                                </div>

                                <p th:unless="${product.flashSalePrice != null}"
                                    class="text-dark fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                    th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                    500.000 đ
                                </p>
                            </div>
                        </div>

                        <div class="card-footer bg-transparent border-top-0 p-3 pt-0">
                            <a th:href="@{/cart/add/{id}(id=${product.id})}"
                                class="btn btn-primary w-100 btn-sm rounded-1 text-uppercase">Thêm vào giỏ</a>
                        </div>
                    </div>
                </div>

                <!-- Empty state -->
                <div th:if="${products == null || products.isEmpty()}" class="col-12 text-center py-5">
                    <p class="text-muted">Chưa có sản phẩm nào. Vui lòng quay lại sau.</p>
                </div>
            </div>
        </div>

    </div>
</body>

</html>