<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{decorators/main}">

<head>
    <title>Trang chủ - OriShop</title>
</head>

<body>
    <div layout:fragment="content" class="bg-light pb-5">

        <!-- Main Section: Banner (Full Width) -->
        <div class="container-fluid p-0 mb-5">
            <div id="mainBannerCarousel" class="carousel slide shadow-sm overflow-hidden" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#mainBannerCarousel" data-bs-slide-to="0" class="active"
                        aria-current="true"></button>
                    <button type="button" data-bs-target="#mainBannerCarousel" data-bs-slide-to="1"></button>
                    <button type="button" data-bs-target="#mainBannerCarousel" data-bs-slide-to="2"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="d-flex align-items-center justify-content-center position-relative"
                            style="height: 380px; background: linear-gradient(45deg, #0f0c29, #302b63, #24243e);">
                            <div class="container z-1">
                                <div class="row align-items-center">
                                    <div class="col-lg-5 text-white text-md-start text-center mb-4 mb-lg-0">
                                        <h1 class="display-5 fw-bold mb-3 font-heading text-light"
                                            style="letter-spacing: 2px;">
                                            BỘ SƯU TẬP MỚI
                                        </h1>
                                        <p class="fs-5 mb-4 opacity-75 fw-light">Đẳng cấp thời thượng<br>Nâng tầm phong
                                            cách</p>
                                        <a href="/product"
                                            class="btn btn-light px-4 py-2 fw-bold rounded-0 text-uppercase shadow-lg hover-lift">
                                            Khám Phá Ngay
                                        </a>
                                    </div>
                                    <div class="col-lg-7">
                                        <div class="row row-cols-3 g-3">
                                            <div class="col" th:each="prod : ${bannerLatestProducts}">
                                                <div class="card h-100 border-0 shadow-sm overflow-hidden"
                                                    style="background: rgba(255,255,255,0.1); backdrop-filter: blur(5px);">
                                                    <a th:href="@{/product/{slug}(slug=${prod.slug})}"
                                                        class="text-decoration-none">
                                                        <div class="ratio ratio-1x1 bg-white">
                                                            <img th:src="${prod.images != null && !prod.images.isEmpty() ? prod.images[0].imageUrl : 'https://via.placeholder.com/150'}"
                                                                class="card-img-top object-fit-cover" alt="Product">
                                                        </div>
                                                        <div class="card-body p-2 text-center">
                                                            <h6 class="card-title text-white text-truncate small mb-1"
                                                                th:text="${prod.name}">Product Name</h6>
                                                            <span class="badge bg-light text-dark shadow-sm"
                                                                th:text="${#numbers.formatDecimal(prod.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">100.000đ</span>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Slide 2: Coupon Showcase -->
                    <div class="carousel-item">
                        <div class="d-flex align-items-center justify-content-center text-white text-center position-relative"
                            style="height: 380px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="container position-relative z-2">
                                <h1 class="display-5 fw-bold mb-2 font-heading text-uppercase">SĂN VOUCHER HOT</h1>
                                <p class="fs-6 mb-4 opacity-90">Lấy mã giảm giá ngay để mua sắm tiết kiệm hơn!</p>

                                <div class="row justify-content-center g-3"
                                    th:if="${coupons != null && !coupons.isEmpty()}">
                                    <div class="col-md-6 col-lg-4" th:each="coupon, iter : ${coupons}"
                                        th:if="${iter.index < 3}"> <!-- Show max 3 coupons -->
                                        <div class="card border-0 shadow-lg text-dark overflow-hidden transform-hover"
                                            style="border-radius: 15px;">
                                            <div class="card-body p-3 position-relative">
                                                <div
                                                    class="position-absolute top-0 start-0 w-100 h-100 bg-light opacity-25">
                                                </div> <!-- Overlay for depth -->
                                                <div class="position-relative z-1">
                                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                                        <span class="badge bg-danger rounded-pill px-2"
                                                            style="font-size: 0.7rem;">HOT</span>
                                                        <small class="text-muted fw-bold" style="font-size: 0.7rem;">Số
                                                            lượng có hạn</small>
                                                    </div>
                                                    <h4 class="fw-bold text-primary mb-0" th:text="${coupon.code}">
                                                        CODE10</h4>
                                                    <p class="mb-2 text-secondary fw-bold small"
                                                        th:text="${coupon.discountType == 'PERCENT'} ? 'Giảm ' + ${#numbers.formatDecimal(coupon.discountValue, 0, 'COMMA', 0, 'POINT')} + '%' : 'Giảm ' + ${#numbers.formatDecimal(coupon.discountValue, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                                        Giảm 50.000đ</p>
                                                    <button class="btn btn-dark w-100 rounded-pill copy-btn btn-sm"
                                                        th:attr="data-code=${coupon.code}"
                                                        onclick="copyToClipboard(this)">
                                                        <i class="fa fa-copy me-1"></i>Sao chép
                                                    </button>
                                                </div>
                                                <!-- Decorative circles -->
                                                <div class="position-absolute top-50 start-0 translate-middle rounded-circle bg-white"
                                                    style="width: 15px; height: 15px; left: 0;"></div>
                                                <div class="position-absolute top-50 end-0 translate-middle rounded-circle bg-white"
                                                    style="width: 15px; height: 15px; right: -15px;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-3" th:if="${coupons == null || coupons.isEmpty()}">
                                    <div
                                        class="alert alert-light d-inline-block px-4 py-2 rounded-pill shadow-sm small">
                                        <i class="fa fa-ticket me-2 text-warning"></i> Hiện chưa có mã giảm giá nào.
                                        Quay lại sau nhé!
                                    </div>
                                </div>
                            </div>
                            <!-- Background Pattern -->
                            <div class="position-absolute top-0 start-0 w-100 h-100"
                                style="background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px); background-size: 20px 20px;">
                            </div>
                        </div>
                    </div>

                    <!-- Slide 3: Flash Sale Advertisement -->
                    <div class="carousel-item">
                        <div class="d-flex align-items-center justify-content-center position-relative"
                            style="height: 380px; background: linear-gradient(45deg, #FF512F, #DD2476);">
                            <div class="container z-2">
                                <div class="row align-items-center">
                                    <div class="col-lg-5 text-white text-md-start text-center mb-4 mb-lg-0">
                                        <span
                                            class="d-inline-block p-2 px-3 bg-white text-danger fw-bold rounded-pill mb-2 shadow-sm animate__animated animate__bounceIn small">
                                            <i class="fa fa-fire me-2"></i>ĐANG DIỄN RA
                                        </span>
                                        <h1 class="display-5 fw-bold mb-2 font-heading fst-italic text-uppercase"
                                            style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">SIÊU FLASH SALE</h1>
                                        <p class="fs-5 mb-4 fw-light">Săn deal chớp nhoáng<br>Giá rẻ vô địch</p>

                                        <div class="d-flex gap-3 justify-content-md-start justify-content-center">
                                            <a href="/flash-sale"
                                                class="btn btn-light px-4 py-2 fw-bold rounded-pill text-danger text-uppercase shadow-lg hover-scale">
                                                <i class="fa fa-bolt me-2"></i>Săn ngay kẻo lỡ
                                            </a>
                                        </div>
                                    </div>

                                    <div class="col-lg-7">
                                        <div class="row row-cols-3 g-3">
                                            <!-- If no flash sale products, show placeholders or message, but typically we assume there are -->
                                            <div class="col" th:each="fsp : ${bannerFlashSaleProducts}">
                                                <div class="card h-100 border-0 shadow-sm overflow-hidden"
                                                    style="background: rgba(255,255,255,0.9);">
                                                    <div
                                                        class="position-absolute top-0 end-0 m-1 z-1 bg-warning rounded-pill px-2 py-0">
                                                        <small class="text-danger fw-bold" style="font-size: 0.7rem;"
                                                            th:text="${'-' + ((1 - fsp.salePrice.doubleValue() / fsp.product.price.doubleValue()) * 100).intValue() + '%'}">-50%</small>
                                                    </div>
                                                    <a th:href="@{/product/{slug}(slug=${fsp.product.slug})}"
                                                        class="text-decoration-none">
                                                        <div class="ratio ratio-1x1 bg-white">
                                                            <img th:src="${fsp.product.images != null && !fsp.product.images.isEmpty() ? fsp.product.images[0].imageUrl : 'https://via.placeholder.com/150'}"
                                                                class="card-img-top object-fit-cover" alt="Product">
                                                        </div>
                                                        <div class="card-body p-2 text-center">
                                                            <h6 class="card-title text-dark text-truncate small mb-1"
                                                                th:text="${fsp.product.name}">Product Name</h6>
                                                            <div
                                                                class="d-flex justify-content-center gap-1 align-items-baseline">
                                                                <span class="text-danger fw-bold small"
                                                                    th:text="${#numbers.formatDecimal(fsp.salePrice, 0, 'COMMA', 0, 'POINT')} + 'đ'">100k</span>
                                                                <span class="text-muted text-decoration-line-through"
                                                                    style="font-size: 0.7rem;"
                                                                    th:text="${#numbers.formatDecimal(fsp.product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">200k</span>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- Empty State in Flash Sale Slider if list is empty -->
                                            <div class="col-12 text-center text-white"
                                                th:if="${bannerFlashSaleProducts == null || bannerFlashSaleProducts.isEmpty()}">
                                                <p class="opacity-75">Hiện không có sản phẩm nào trong Flash Sale.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Floating Elements decoration -->
                                <i class="fa fa-star position-absolute text-warning opacity-50"
                                    style="top: 15%; left: 5%; font-size: 2rem; animation: float 3s ease-in-out infinite;"></i>
                            </div>
                            <div class="position-absolute top-0 start-0 w-100 h-100"
                                style="background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.05) 20px);">
                            </div>
                        </div>
                    </div>

                    <script>
                        function copyToClipboard(btn) {
                            const code = btn.getAttribute('data-code');
                            navigator.clipboard.writeText(code).then(() => {
                                const originalText = btn.innerHTML;
                                btn.innerHTML = '<i class="fa fa-check me-2"></i>Đã sao chép';
                                btn.classList.remove('btn-dark');
                                btn.classList.add('btn-success');
                                setTimeout(() => {
                                    btn.innerHTML = originalText;
                                    btn.classList.add('btn-dark');
                                    btn.classList.remove('btn-success');
                                }, 2000);
                            });
                        }
                    </script>
                    <style>
                        .hover-scale:hover {
                            transform: scale(1.05);
                        }

                        @keyframes float {
                            0% {
                                transform: translateY(0px);
                            }

                            50% {
                                transform: translateY(-20px);
                            }

                            100% {
                                transform: translateY(0px);
                            }
                        }

                        .transform-hover {
                            transition: transform 0.3s ease;
                        }

                        .transform-hover:hover {
                            transform: translateY(-5px);
                        }
                    </style>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#mainBannerCarousel"
                    data-bs-slide="prev" style="z-index: 10;">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#mainBannerCarousel"
                    data-bs-slide="next" style="z-index: 10;">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>

        <!-- Service Icons (Clean Strip) -->
        <div class="container mb-5">
            <div class="row g-4 text-center">
                <div class="col-md-4">
                    <div class="p-4 border border-light rounded-0 shadow-sm bg-white h-100 hover-card">
                        <i class="fa-solid fa-truck-fast fa-2x mb-3 text-dark"></i>
                        <h6 class="fw-bold text-uppercase font-heading">Giao hàng miễn phí</h6>
                        <p class="text-muted small mb-0">Cho đơn hàng từ 500k</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-4 border border-light rounded-0 shadow-sm bg-white h-100 hover-card">
                        <i class="fa-solid fa-rotate-left fa-2x mb-3 text-dark"></i>
                        <h6 class="fw-bold text-uppercase font-heading">Đổi trả 7 ngày</h6>
                        <p class="text-muted small mb-0">Thủ tục đơn giản, nhanh chóng</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-4 border border-light rounded-0 shadow-sm bg-white h-100 hover-card">
                        <i class="fa-solid fa-shield-halved fa-2x mb-3 text-dark"></i>
                        <h6 class="fw-bold text-uppercase font-heading">Hàng chính hãng</h6>
                        <p class="text-muted small mb-0">Cam kết hoàn tiền 200% nếu giả</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Horizontal Categories Scroll -->
        <div class="container mb-5">
            <div class="text-center mb-4">
                <h3 class="text-uppercase fw-bold font-heading text-dark" style="letter-spacing: 1px;">Danh Mục Sản Phẩm
                </h3>
                <div class="mx-auto bg-dark" style="width: 60px; height: 3px;"></div>
            </div>

            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a th:each="cat : ${globalCategories}"
                    th:href="@{/category/{slug}(slug=${cat.slug != null && cat.slug != '' ? cat.slug : cat.id})}"
                    class="btn btn-outline-dark rounded-0 px-4 py-2 text-uppercase fw-bold"
                    style="min-width: 150px; transition: all 0.3s;"
                    onmouseover="this.classList.remove('btn-outline-dark'); this.classList.add('btn-dark');"
                    onmouseout="this.classList.add('btn-outline-dark'); this.classList.remove('btn-dark');">
                    <span th:text="${cat.name}">Category</span>
                </a>
            </div>
        </div>

        <!-- Flash Sale Section -->
        <!-- Flash Sale Section -->
        <div class="container mb-5" th:if="${activeFlashSales != null && !activeFlashSales.isEmpty()}">
            <div class="bg-white shadow-sm border p-4">
                <!-- Header with Timer -->
                <div class="d-flex flex-wrap align-items-center justify-content-between mb-4 gap-3">
                    <div class="d-flex align-items-center gap-4">
                        <div class="d-flex align-items-center">
                            <i class="fa fa-bolt fa-2x text-warning me-2" style="animation: flash 1s infinite;"></i>
                            <h2 class="mb-0 fw-bold text-uppercase fst-italic"
                                style="color: #ee4d2d; letter-spacing: -1px;">FLASH DEAL</h2>
                        </div>

                        <!-- Countdown Timer Blocks -->
                        <div class="d-flex align-items-center gap-2 font-monospace fw-bold fs-5 text-white"
                            id="flash-countdown-blocks">
                            <div class="bg-dark rounded px-2 py-1" id="timer-hours">00</div>
                            <span class="text-dark">:</span>
                            <div class="bg-dark rounded px-2 py-1" id="timer-minutes">00</div>
                            <span class="text-dark">:</span>
                            <div class="bg-dark rounded px-2 py-1" id="timer-seconds">00</div>
                        </div>
                    </div>

                    <a href="/flash-sale" class="text-muted text-decoration-none fw-bold small">XEM TẤT CẢ DEAL +</a>
                </div>

                <!-- Product List -->
                <div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-3">
                    <div class="col" th:each="fsp : ${activeFlashSales[0].flashSaleProducts}">
                        <!-- Use FlashSaleProduct (fsp) to access product and sale price -->
                        <div class="card h-100 border hover-shadow transition-all position-relative overflow-hidden">

                            <!-- Badges -->
                            <div class="position-absolute top-0 start-0 m-2 z-1">
                                <span class="badge bg-danger rounded-0">MUA 1 ĐƯỢC 2</span>
                            </div>
                            <!-- Discount Bubble -->
                            <div class="position-absolute top-0 end-0 m-2 z-1 bg-warning rounded-circle d-flex flex-column align-items-center justify-content-center shadow-sm"
                                style="width: 45px; height: 45px; line-height: 1;">
                                <span class="text-danger fw-bold small"
                                    th:text="${'-' + ((1 - fsp.salePrice.doubleValue() / fsp.product.price.doubleValue()) * 100).intValue() + '%'}">-50%</span>
                            </div>

                            <a th:href="@{/product/{slug}(slug=${fsp.product.slug})}" class="text-decoration-none">
                                <div class="ratio ratio-1x1 bg-light">
                                    <img th:src="${fsp.product.images != null && !fsp.product.images.isEmpty() ? fsp.product.images[0].imageUrl : 'https://via.placeholder.com/300'}"
                                        class="card-img-top object-fit-cover" alt="Product Image">
                                </div>
                            </a>

                            <div class="card-body p-2 d-flex flex-column">
                                <a th:href="@{/product/{slug}(slug=${fsp.product.slug})}"
                                    class="text-decoration-none text-dark mb-2">
                                    <h6 class="card-title text-truncate small mb-1" th:text="${fsp.product.name}">
                                        Product Name</h6>
                                </a>

                                <div class="mt-auto">
                                    <div class="d-flex align-items-baseline gap-1 flex-wrap mb-2">
                                        <span class="text-danger fw-bold fs-5"
                                            th:text="${#numbers.formatDecimal(fsp.salePrice, 0, 'COMMA', 0, 'POINT')} + 'đ'">100.000đ</span>
                                        <span class="text-muted text-decoration-line-through small"
                                            th:text="${#numbers.formatDecimal(fsp.product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">200.000đ</span>
                                    </div>

                                    <!-- Progress Bar -->
                                    <div class="position-relative w-100 rounded-pill overflow-hidden"
                                        style="height: 16px; background-color: #ffbda6;">
                                        <!-- Fake progress for visual effect -->
                                        <div class="h-100 rounded-pill bg-danger" style="width: 78%;"></div>
                                        <span
                                            class="position-absolute top-50 start-50 translate-middle text-white fw-bold"
                                            style="font-size: 10px; text-shadow: 0 0 2px rgba(0,0,0,0.5);">ĐANG DIỄN RA
                                            78%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timer Script -->
            <script th:inline="javascript">
                (function () {
                    const endTime = [[${ activeFlashSales[0].endTime.time }]];

                    function updateTimer() {
                        const now = new Date().getTime();
                        const distance = endTime - now;

                        if (distance < 0) {
                            document.getElementById("flash-countdown-blocks").innerHTML = "<span class='text-danger fw-bold'>ĐÃ KẾT THÚC</span>";
                            return;
                        }

                        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                        document.getElementById("timer-hours").innerText = (hours < 10 ? "0" + hours : hours);
                        document.getElementById("timer-minutes").innerText = (minutes < 10 ? "0" + minutes : minutes);
                        document.getElementById("timer-seconds").innerText = (seconds < 10 ? "0" + seconds : seconds);
                    }

                    setInterval(updateTimer, 1000);
                    updateTimer();
                })();
            </script>
            <style>
                @keyframes flash {

                    0%,
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }

                    50% {
                        opacity: 0.5;
                        transform: scale(1.1);
                    }
                }
            </style>
        </div>

        <!-- Best Selling Section -->
        <div class="container mb-5" th:if="${bestSellers != null && !bestSellers.isEmpty()}">
            <div class="d-flex align-items-center justify-content-between mb-4 border-bottom pb-2">
                <h3 class="text-uppercase fw-bold font-heading text-dark mb-0">Sản phẩm bán chạy</h3>
            </div>

            <div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-4">
                <!-- Loop products -->
                <div class="col" th:each="product : ${bestSellers}">
                    <div class="card h-100 card-product">
                        <!-- Badges -->
                        <span th:if="${product.flashSalePrice != null}"
                            class="position-absolute top-0 start-0 badge bg-danger m-2 rounded-0">-<span
                                th:text="${#numbers.formatInteger((1 - product.flashSalePrice/product.price) * 100, 0)}"></span>%</span>

                        <span
                            class="position-absolute top-0 end-0 badge bg-warning text-dark m-2 rounded-0 shadow-sm"><i
                                class="fa-solid fa-crown"></i> Hot</span>

                        <a th:href="@{/product/{slug}(slug=${product.slug != null && product.slug != '' ? product.slug : product.id})}"
                            class="text-decoration-none">
                            <img th:src="${product.images != null && !product.images.isEmpty() ? product.images[0].imageUrl : 'https://via.placeholder.com/300'}"
                                class="card-img-top" alt="Product Image" style="height: 220px; object-fit: cover;">
                        </a>

                        <div class="card-body p-3 text-center">
                            <a th:href="@{/product/{slug}(slug=${product.slug != null && product.slug != '' ? product.slug : product.id})}"
                                class="text-decoration-none text-dark">
                                <h6 class="card-title text-truncate mb-1" th:text="${product.name}">Tên sản phẩm</h6>
                            </a>

                            <div class="mb-2 small">
                                <span class="text-warning" th:if="${product.reviewCount > 0}">
                                    <i class="fa fa-star"></i> <span th:text="${product.averageRating}"></span>
                                    <span class="text-muted"> (<span th:text="${product.reviewCount}"></span>)</span>
                                </span>
                                <span class="text-muted" th:unless="${product.reviewCount > 0}">
                                    <i class="fa fa-star-o text-warning"></i> Chưa có đánh giá
                                </span>
                            </div>

                            <div>
                                <div th:if="${product.flashSalePrice != null}">
                                    <p class="text-danger fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                        th:text="${#numbers.formatDecimal(product.flashSalePrice, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        400.000 đ
                                    </p>
                                    <small class="text-muted text-decoration-line-through small"
                                        th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        500.000 đ
                                    </small>
                                </div>

                                <div th:unless="${product.flashSalePrice != null}">
                                    <div
                                        th:if="${product.discountPrice != null && product.discountPrice > 0 && product.discountPrice < product.price}">
                                        <p class="text-danger fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                            th:text="${#numbers.formatDecimal(product.discountPrice, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                            Sale</p>
                                        <small class="text-muted text-decoration-line-through small"
                                            th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">Original</small>
                                    </div>
                                    <p th:unless="${product.discountPrice != null && product.discountPrice > 0 && product.discountPrice < product.price}"
                                        class="text-dark fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                        th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        500.000 đ</p>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer bg-transparent border-top-0 p-3 pt-0">
                            <a th:href="@{/cart/add/{id}(id=${product.id})}"
                                class="btn btn-outline-primary w-100 btn-sm rounded-1 text-uppercase">Thêm vào giỏ</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product List Section -->
        <div class="container">
            <div class="d-flex align-items-center justify-content-between mb-4 border-bottom pb-2">
                <h3 class="text-uppercase fw-bold font-heading text-dark mb-0">Mới cập nhật</h3>
                <a href="/product" class="btn btn-link text-secondary text-decoration-none">Xem tất cả <i
                        class="fa-solid fa-arrow-right"></i></a>
            </div>

            <div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-4">
                <!-- Loop products -->
                <div class="col" th:each="product : ${products}">
                    <div class="card h-100 card-product">
                        <!-- Badges -->
                        <span th:if="${product.flashSalePrice != null}"
                            class="position-absolute top-0 start-0 badge bg-danger m-2 rounded-0">-<span
                                th:text="${#numbers.formatInteger((1 - product.flashSalePrice/product.price) * 100, 0)}"></span>%</span>

                        <a th:href="@{/product/{slug}(slug=${product.slug != null && product.slug != '' ? product.slug : product.id})}"
                            class="text-decoration-none">
                            <img th:src="${product.images != null && !product.images.isEmpty() ? product.images[0].imageUrl : 'https://via.placeholder.com/300'}"
                                class="card-img-top" alt="Product Image" style="height: 220px; object-fit: cover;">
                        </a>

                        <div class="card-body p-3 text-center">
                            <a th:href="@{/product/{slug}(slug=${product.slug != null && product.slug != '' ? product.slug : product.id})}"
                                class="text-decoration-none text-dark">
                                <h6 class="card-title text-truncate mb-1" th:text="${product.name}">Tên sản phẩm</h6>
                            </a>

                            <div class="mb-2 small">
                                <span class="text-warning" th:if="${product.reviewCount > 0}">
                                    <i class="fa fa-star"></i> <span th:text="${product.averageRating}"></span>
                                    <span class="text-muted"> (<span th:text="${product.reviewCount}"></span>)</span>
                                </span>
                                <span class="text-muted" th:unless="${product.reviewCount > 0}">
                                    <i class="fa fa-star-o text-warning"></i> Chưa có đánh giá
                                </span>
                            </div>

                            <div>
                                <div th:if="${product.flashSalePrice != null}">
                                    <p class="text-danger fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                        th:text="${#numbers.formatDecimal(product.flashSalePrice, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        400.000 đ
                                    </p>
                                    <small class="text-muted text-decoration-line-through small"
                                        th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        500.000 đ
                                    </small>
                                </div>

                                <p th:unless="${product.flashSalePrice != null}"
                                    class="text-dark fw-bold mb-0 font-heading" style="font-size: 1.1rem;"
                                    th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                    500.000 đ
                                </p>
                            </div>
                        </div>

                        <div class="card-footer bg-transparent border-top-0 p-3 pt-0">
                            <a th:href="@{/cart/add/{id}(id=${product.id})}"
                                class="btn btn-primary w-100 btn-sm rounded-1 text-uppercase">Thêm vào giỏ</a>
                        </div>
                    </div>
                </div>

                <!-- Empty state -->
                <div th:if="${products == null || products.isEmpty()}" class="col-12 text-center py-5">
                    <p class="text-muted">Chưa có sản phẩm nào. Vui lòng quay lại sau.</p>
                </div>
            </div>
        </div>

    </div>
</body>

</html>